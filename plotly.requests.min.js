var FnewPlot=Plotly.newPlot;var Fplot=Plotly.plot;var FaddTraces=Plotly.addTraces;var Frestyle=Plotly.restyle;Plotly.converters={};Plotly.plot=function(gd,data,layout,datasources,config){FnewPlot(gd,data,layout,config);var gd=getGraphDiv(gd);gd.datasources=datasources;loadData(gd,data,datasources)};Plotly.newPlot=function(gd,data,layout,datasources,config){Plotly.plot(gd,data,layout,datasources,config)};Plotly.addTraces=function(gd,traces,newIndices){FaddTraces(gd,traces,newIndices);var gd=getGraphDiv(gd);loadData(gd,traces,gd.datasources)};Plotly.restyle=function(gd,update,indices){Frestyle(gd,update,indices);gd.changed=false;var gd=getGraphDiv(gd);loadData(gd,gd.data,gd.datasources)};Plotly.updateDataSources=function(gd,update){var gd=getGraphDiv(gd);gd.datasources=update;loadData(gd,gd.data,gd.datasources)};Plotly.converters.KDB=function(response,parameters){var resp=JSON.parse(response);var xy=[[],[]];var values=resp.queries[0].results[0].values;for(var i=1;i<values.length;i++){xy[0].push(new Date(values[i][0]));xy[1].push(parseFloat(values[i][1]))}return xy};Plotly.converters.CSV=function(response,parameters){var xy=[[],[]];var lines=response.split("\n");for(var i=1;i<lines.length;i++){var val=lines[i].split(";");xy[0].push(new Date(val[parameters.columnX]));xy[1].push(val[parameters.columnY])}return xy};function loadData(gd,traces,datasources,tIndices,dsIndices){for(var i=0;i<datasources.length;i++){(function(index){var u=datasources[index].url;for(key in datasources[index].parameters){u+=key+"="+datasources[index].parameters[key]+"&"}var updateTraces=function(u){Plotly.d3.xhr(u,function(error,result){for(var k=0;k<traces.length;k++){if(traces[k].source!=null){if(traces[k].source.id==datasources[index].id){if(traces[k].source.converter.name!=null){var xy=Plotly.converters[traces[k].source.converter.name](result.responseText,traces[k].source.converter.parameters);Frestyle(gd,{x:[xy[0]],y:[xy[1]]},k)}else{var tmpFunc=new Function("response","param",traces[k].source.converter.script);var xy=tmpFunc(result.responseText,traces[k].source.converter.parameters);Frestyle(gd,{x:[xy[0]],y:[xy[1]]},k)}}}}})};updateTraces(u)})(i)}}function refreshData(gd,traces,datasources,tIndices,dsIndices){var refresh=5;console.log(datasources);if(refresh){var id=setInterval(function(){loadData(gd,traces,datasources,tIndices,dsIndices)},refresh*1e3)}}function getGraphDiv(gd){var gdElement;if(typeof gd==="string"){gdElement=document.getElementById(gd);if(gdElement===null){throw new Error("No DOM element with id '"+gd+"' exists on the page.")}return gdElement}else if(gd===null||gd===undefined){throw new Error("DOM element provided is null or undefined")}return gd}